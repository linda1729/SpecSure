# 2025-11-29 修改记录

- backend/app/services/cnn_gateway.py：新增 CNN 网关，支持远端 HTTP 调用与本地占位推理，并提供状态信息。
- backend/app/services/model_service.py：训练接口接入 cnn3d 类型与网关元数据输出，增加 `/api/models/cnn/status`。
- backend/API.md、backend/API_FULL.md：更新训练参数示例，新建全量接口清单含云端 CNN 协议。
- mockfrontend/index.html、mockfrontend/app.js、mockfrontend/styles.css：训练页展示 CNN 服务状态、默认模型 B 选用 3D CNN，优化配色与交互控件（Patch Size 等）。
- requirements.txt：补充 requests 依赖，方便云端调用。
- backend/app/services/cnn_gateway.py：增加远端失败自动回退本地占位推理（受 `CNN_FALLBACK_LOCAL` 环境变量控制，默认开启）。
- backend/app/services/dataset_service.py：新增 `/api/datasets/demo` 接口，可一键生成/返回内置示例数据和标注。
- backend/app/core/bootstrap.py：`ensure_demo_data` 支持强制生成 demo，即便已有其他数据也能一键得到示例数据+标注。
- mockfrontend/index.html、mockfrontend/app.js：新增“加载示例数据”按钮；若列表为空自动请求示例数据，便于直接运行演示，并在选择训练数据集时自动匹配对应标注。
- 将 `frontend` 重命名为 `mockfrontend`（静态调试前端），避免与后续正式前端冲突，相关文档路径已更新。
- backend/app/services/cnn_gateway.py：改为直接调用本地 HybridSN（PyTorch）训练与推理，支持远端失败自动回退并返回详细训练元数据。
- backend/app/services/model_service.py：放宽标注与预处理数据集的关联校验，暂时跳过 SVM 分支以专注 CNN/随机森林训练。
- requirements.txt：新增 torch 依赖，便于本地运行 HybridSN 模型。
- mockfrontend/app.js：训练按钮新增加载态与提示，告知训练过程可能耗时、避免误以为无响应。
- backend/app/core/bootstrap.py：启动时若示例数据/标注文件缺失会自动重建，避免历史路径失效导致无法加载数据集。
- backend/app/services/dataset_service.py：加载数据集时尝试自动修正路径（raw/preprocessed 目录下的同名文件），修正后回写元数据。
- backend/app/services/model_service.py：标注文件缺失时自动查找 labels 目录同名文件并回写，避免因路径失效而加载失败。
- backend/app/services/dataset_service.py：新增 `/api/datasets/import-hybrid/{dataset_name}`（SA/PU/IP）并在 `/api/datasets/demo` 时自动导入 HybridSN 自带真实数据集，默认存为 ds_hsi_xx/lb_hsi_xx。
- backend/app/services/dataset_service.py：修复 HybridSN 导入使用错误的标签文件键；`/api/datasets/demo` 始终校验并重建示例数据，同时自动导入 SA/PU/IP（若文件存在）。
