# **实验 6：【Alpha 1/3】项目 Alpha 冲刺报告**

> 概述：本周主要进行的工作是后端+CNN。大家进度不太一样，所有的工作文档我们都会提交到相应周次的仓库文件夹中，本周为https://github.com/linda1729/SpecSure/blob/main/dos/w10/，看仓库其实会比看报告更直观一点。
>
> 组长博客更新会慢于Github，因为网页部署有一定免费额度。



项目名：**SpecSure（澜瞳）**

小组名：**BlueArray（潮霸）**

------

# **一、基本情况**

- **团队 ID：** 01
- **组长博客地址：** https://blog.linda1729.com/columns/specsure/
- **小组 Github 仓库地址：** https://github.com/linda1729/SpecSure
- **小组成员：**
  - 前端负责：於佳杰
  - 后端负责：刘芳宇（组长）
  - 模型训练（CNN）：陈怡冰
  - 模型训练（SVM）：邓林
- **本次冲刺范围**：根据附件的项目选题要求和功能结构，完成原型系统的 Alpha 版本雏形，包括需求确认、数据流程确定、模型初版、接口草案和页面原型等。
  - 选题参考：海岸带高光谱数据分类系统（https://github.com/linda1729/SpecSure/blob/main/dos/w9/选题.md）
  - 分工参考：四模块（前端 / 后端 / SVM / CNN）并行推进（https://github.com/linda1729/SpecSure/blob/main/dos/w9/3.分工参考.pdf）
  - 项目准备内容（数据、技术栈、工具）（https://github.com/linda1729/SpecSure/blob/main/dos/w9/5.项目准备工作.pdf）
  - 系统预期功能及结构（最终目标）（https://github.com/linda1729/SpecSure/blob/main/dos/w9/1.预期结果描述.pdf）

------

# **二、冲刺概况汇报**

------

## 前端：於佳杰

### ✅ **过去完成了哪些任务**

1. **完成前端整体需求确认**
   
   根据系统规划，本前端项目需实现海岸带高光谱分类工作流的四大主功能：
   
     **（1）Data Import – 数据导入模块**
   
   - 上传高光谱 `.hsi` / `.hdr` / `.mat` 数据文件。
   - 读取并显示低分辨率假彩色图（RGB合成）。
   - 可视化光谱曲线（点击像素 → 展示像素光谱）。
   - 支持多数据集管理（最近上传列表）。
   
   ------
   
   **（2）Preprocessing – 预处理模块**
   
   前端需要提供一组可视化与参数调节 UI，用于：
   
   - **降噪处理（可视化前后对比）**
   - **波段选择（Band Selection）**：多选框 + 波段区间滑块
   - **标准化流程卡片**（如 MinMax / Z-score）
   - 预处理结果预览（假彩色图、光谱变化曲线）
   
   所有操作仅发送参数到后端，不在前端执行实际算法。
   
   ------
   
   **（3）Model Training – 模型训练模块（SVM / CNN）**
   
   前端需要支持双模型机制：
   
    **SVM：**
   
   - 参数输入：C、gamma、kernel 等
   - 训练状态可视化：进度条 + 训练日志框
   
    **CNN：**
   
   - 参数：epoch、learning rate、optimizer、batch size
   - 展示实时/伪实时的训练曲线（loss & accuracy）
   - 环形训练进度动画
   
   训练任务全部转交后端 `/classify_svm` 或 `/classify_cnn`，前端仅呈现返回过程与可视化。
   
   ------
   
    **（4）Results & Evaluation – 分类结果与评估模块**
   
   前端需提供：
   
   - **分类结果伪彩色图展示**（鼠标悬浮显示类别）
   
   - **光谱曲线对比图（预测 vs 原始）**
   
   - **三个圆形统计图**：类别比例、正确率、召回率
   
   - **混淆矩阵可视化（方阵布局）**
   
   - 下载结果按钮（mask、图像、log）
   
     
   
2. **制作前端原型页面（静态版）**
   
   -  **整体技术栈**
   
     - **框架：React**
     - **样式：TailwindCSS + 自定义渐变 / 发光效果**
     - **动画：Framer Motion + GSAP**
     - **可视化：ECharts / Chart.js / D3（根据你项目已有代码保持不变）**
     - **WebGL 特效层：Three.js 粒子系统（仅装饰用途）**
   
     以下为实际页面结构（基于你的 API 和高光谱场景）：
   
     ------
   
      **（1）数据导入界面**
   
     使用 mock 或真实上传 API `/upload_hsi`：
   
     **组件构成：**
   
     - **文件上传卡片**（拖拽上传 + 点击上传按钮）
     - **数据集列表组件**（最近上传）
     - **假彩色图展示区**（RGB 合成）
     - **像素光谱查看器**（点击图 → 曲线图）
     - 三个主要组件布局为“两列布局 + 底部工具栏”
   
     **动画设计（静态版也要展示框架）：**
   
     - 上传卡片 → 发光脉冲
     - 假彩色图加载 → 渐变淡入
     - 光谱曲线 → 曲线绘制动画
   
     ------
   
      **（2）预处理页面**
   
     模拟后端 `/preprocess` 返回结构：
   
      **UI 功能区： **
   
     - 降噪模块（卡片 + 参数区）
     - 波段选择（滑条 + 数值框）
     - 标准化模块（选择框）
     - “预处理”按钮
     - 结果区（Before/After 两图对比）
   
     **动画：**
   
     - 参数卡片悬浮 → 玻璃拟物光效
     - Before/After 图像 → 中间滑动对比效果
     - 波段滑条拖动 → 波纹/光流动画
   
     ------
   
      **（3）模型训练页面（SVM / CNN 双模型）**
   
     **页面结构：**
   
     - 模型选择 Tabs
     - 参数输入表单（动态显示）
     - 训练按钮 + 正在训练动画
     - 日志显示框
     - CNN 训练曲线（伪实时）
     - 训练成功提示动画（星芒扩散）
   
     **动画设计：**
   
     - 卡片进入 → 3D 翻转
     - 点击训练 → 粒子聚集成“模型图标”
     - epoch 更新 → 曲线闪动效果
   
     ------
   
      **（4）结果可视化页面**
   
     使用 mock 方式模拟 `/evaluate`：
   
     **组件列表：**
   
     - 分类结果伪彩色图 + 悬浮信息
     - 三个圆形图（比例 / 精度 / 召回）
     - 混淆矩阵（高亮当前行列）
     - 结果下载栏
   
     **动画设计：**
   
     - 伪彩色图：光线扫描线 sweep 动画
     - 圆形统计图：从 0% 缓慢增长动画
     - 混淆矩阵：格子按行/列渐亮
     - 光谱对比曲线：线条绘制动画
   
3. **与后端协商 API 参数格式**
   
   **（1） `/upload_hsi` – 上传高光谱数据**
   
    **请求**
   
   - 方法：POST
   - 类型：`multipart/form-data`
   - 字段：`file`（高光谱文件）
   
    **返回**
   
   ```
   {
     "status": "ok",
     "dataset_id": "xxx",
     "rgb_preview": "...", 
     "wavelengths": [...],
     "spectra_sample": [...]
   }
   ```
   
   ------
   
    **（2） `/preprocess` – 预处理接口**
   
   请求
   
   ```
   {
     "dataset_id": "xxx",
     "denoise": true,
     "band_range": [10, 120],
     "normalize": "zscore"
   }
   ```
   
   **返回**
   
   ```
   {
     "status": "ok",
     "preview_before": "...",
     "preview_after": "...",
     "spectra_change_curve": [...]
   }
   ```
   
   ------
   
    **（3） `/classify_svm` – SVM 分类**
   
   **请求示例**
   
   ```
   {
     "dataset_id": "xxx",
     "C": 1.0,
     "gamma": 0.1
   }
   ```
   
   ------
   
    **（4） `/classify_cnn` – CNN 分类与训练可视化**
   
   ### 请求示例
   
   ```
   {
     "dataset_id": "xxx",
     "epoch": 50,
     "lr": 0.0001,
     "optimizer": "Adam"
   }
   ```
   
   **返回（可能为流式日志）**
   
   ```
   {
     "epoch": 1,
     "loss": 0.42,
     "acc": 0.87
   }
   ```
   
   ------
   
   **（5） `/evaluate` – 结果评估**
   
   返回：
   
   - 混淆矩阵
   - 分类图（伪彩色）
   - 各类指标（accuracy / recall / f1）
   
   ------

### 📁 **Github 提交记录截图**

![image-20251202202905444](../AppData/Roaming/Typora/typora-user-images/image-20251202202905444.png)

### 🔮 **接下来的计划**

- 继续整理和评估大家的需求

- 完成初版


### ⚠ **遇到的困难**

- 需求很多，有时还矛盾需要不断筛选和沟通

------

## 后端&组长工作：刘芳宇

### ✅ **过去完成了哪些任务**

1. **完成后端框架搭建**
   - 使用 FastAPI建立基础项目框架
   - 设计了 RESTful API 架构
   - All in all，整体的壳是已经搭建好了，带模拟数据能运行。
   - 具体的修改见https://github.com/linda1729/SpecSure/tree/main/dos/w10/backend中的文档。
2. **完成 mock 接口编写**
   - 我在CNN和SVM的同学提供代码前mock了一些数据去调试。
   - 周末的时候负责CNN的同学给了基础代码，我尝试去做本地联调，并一直失败。
3. **做了一个模拟前端方便后期调试**
   - 为了能方便点测试我的后端，我先mock了一个前端，给每个功能都做了一个基础界面。
   - 然后也发现了，或许前端最大的问题是在于：各类图像的呈现......（希望做前端的同学也多加注意）
4. **组长工作**
   - 组织小组会议
   - 文档撰写和组织工作，我完成的工作文档如下：
     - 预期结果描述
     - 预期结果草图
     - 分工参考
     - 取名
     - 项目准备工作
     - 分支管理办法

### 📁 **Github 提交记录截图**

![image-20251202202924329](../AppData/Roaming/Typora/typora-user-images/image-20251202202924329.png)

![image-20251202202941825](../AppData/Roaming/Typora/typora-user-images/image-20251202202941825.png)

![image-20251202203700725](../AppData/Roaming/Typora/typora-user-images/image-20251202203700725.png)

### 🔮 **接下来的计划**

- 接上CNN

### ⚠ 遇到的困难

- 接不上CNN（痛苦面具）

------

## **CNN 模型：陈怡冰**

### ✅ 过去完成的任务

1. **完成 CNN 模型初版（3D CNN / HybridSN）**
   - 根据论文HybirdSN源代码进行修改，讲框架改为pytorch
   - 实现 patch 提取、训练脚本、评估模块
2. **完成第一次训练**
   - 使用现有高光谱数据（如 PaviaU）训练了模型，得到训练权重（PCA和模型参数分开保存）
   - 得到初步 ：
     - 总体准确率（Overall Accuracy, OA）
     - 平均准确率（Average Accuracy, AA）
     - Kappa 系数
     - 每类准确率
     - 混淆矩阵（后面可以改成图片）
     - 完整分类报告`classification_report_pytorch.txt`
3. **推理功能**
   - 完整图像预测：
     - 对整张高光谱图像进行逐像素分类
     - 自动跳过零标签像素
     - 使用训练时保存的 PCA 转换器（这里有一个问题就是因为训练集的大小不同，使得每次只能使用训练的数据进行推理）
   - **可视化输出**：
     - 生成预测结果可视化图（`predictions_pytorch.jpg`）
     - 生成地面真值可视化图（`{dataset}_ground_truth_pytorch.jpg`）
     - 使用 spectral 库的颜色映射
   - **独立推理模式**：支持 `--inference_only` 参数仅执行推理而不训练
4. **调研多模态方案**
   - 探索是否可将光谱特征 + 空间纹理联合建模

### 📁 Github 提交记录截图

![image-20251202203005159](../AppData/Roaming/Typora/typora-user-images/image-20251202203005159.png)

### 🔮 接下来的计划

- 在后端给的数据格式上重新训练（这个看情况，应当与原有数据格式为准，而不是mock的数据）
- 输出最终可部署模型
- 尝试学长多模态模型
- 代码重构与模块化

### ⚠ 困难

- GPU 资源有限，训练速度偏慢
- `eval_epoch` 函数中收集预测结果的代码位置需要修正（当前在循环外）
- 代码过长，所有功能都在单文件中，需要模块化
- 缺少训练过程的可视化
- 没有早停（Early Stopping）机制

------

## **SVM 模型：邓林**

### ✅ 过去完成的任务

1. **完成 SVM 模型 baseline**
   - 实现了 **SVM** 的基本训练和预测功能。
   - 支持 **线性核** 和 **RBF 核**。
   - 完成了高光谱数据的预处理、训练以及分类图的生成（二维预测矩阵）。
2. **完成性能评估模块**
   - 计算了 **OA (Overall Accuracy)**，**Kappa 系数** 和 **混淆矩阵** 来评估模型的分类效果。
3. **数据维度统一化与前端接口对接**
   - 与 **CNN 模型** 同学对齐数据维度，确保输入数据格式统一，能够兼容不同模型的输入。
   - 设计了 **FastAPI 接口**，允许前端上传数据并调用 SVM 模型进行训练和预测。
4. **训练与预测接口**
   - 提供了 SVM 模型的训练接口：`POST /api/modelA/train`。
   - 提供了预测接口：`POST /api/modelA/predict`，能够生成分类结果并保存为 `.npy` 文件供前端展示。

### 📁 Github 提交记录截图

![image-20251202203117277](../AppData/Roaming/Typora/typora-user-images/image-20251202203117277.png)

### 🔮 接下来的计划

- **调参优化 SVM 模型精度**
  - 继续调整 **C**、**gamma** 等超参数，提高模型的精度和分类能力。
  - 尝试不同的核函数（如 **线性核**、**多项式核**），对比性能。
- **生成可部署的模型文件**
  - 产出 **`.joblib`** 或 **`.pkl`** 文件，确保 SVM 模型可以部署到生产环境中，支持在线预测。
- **产出性能对比图**
  - 生成 **性能对比图**，比较不同参数和核函数下的 **OA**、**Kappa** 等指标，方便前端展示和选择。
- **进一步优化性能**
  - 结合 **PCA** 和 **波段选择** 等方法，减少数据维度，优化训练速度。

### ⚠ 困难

- **高光谱数据维度过高，训练时间长**
  - 由于高光谱数据的维度非常高，训练时间较长，考虑使用 **PCA** 或 **波段选择** 来降低维度，提高训练效率。
- **类别边界模糊，分类难度大**
  - 一些类别之间的边界模糊，SVM 难以区分，可能需要结合更多的特征提取和后处理手段来优化分类效果。

------

# **三、冲刺成果展示**

## **1. 组内最新成果展示**

以下成果基于目前 Alpha 阶段进展：

### ① 系统整体 UI 原型

- 数据导入界面：支持展示假彩色图、光谱曲线
- 预处理界面：实现 Noise Reduction / Band Selection / Normalization 三大模块布局
- 模型训练界面：SVM 与 CNN 双卡片切换，支持参数设置
- 分类结果硬编码展示：三图对比结构（原图 / CNN / 标注）
- 混淆矩阵与 OA/Kappa 布局成功复现

------

### **② 后端接口完成度**

已实现 mock API：

```
POST /upload_hsi  
POST /preprocess  
POST /classify_svm  
POST /classify_cnn  
POST /evaluate
```

前后端已经完成格式对齐。

------

### **③ SVM & CNN 初版模型输出**

- SVM 模型已可生成分类图（二维矩阵）
- CNN 初版模型已跑通 patch-based 训练，正在调参

------

### **④ 项目管理完成度**

已完成：

- 小组命名与设计（BlueArray & SpecSure）
- 分支设计与协作模式（feature-frontend / feature-backend / feature-svm / feature-cnn）
- 各模块分工与时间线排布

------

## **2. 站立会议合照**

![image-20251202203215226](../AppData/Roaming/Typora/typora-user-images/image-20251202203215226.png)

------

## **3. 会议时间、地点、内容记录**

- **时间：** 11 月 26 日
- **地点：** 实验室
- **记录内容：**
  - 确认整体 UI 原型结构
  - 同步 SVM/CNN 初版训练进度
  - 讨论后端 API 对接方式
  - 决定是否加入多模态（目前为调研阶段）
  - 讨论前端需求
  - 安排下一周任务：
    - 前端负责联调
    - 后端接入真实模型

